<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Data Display</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            background-color: #9E9C9B;
        }
        
        .content-container {
            width: auto;
            margin: 0 20px;
        }

        table {
            border-collapse: collapse;
            width: 600px;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        .percentage-bar {
            width: 100%;
            height: 20px;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(to right, red 0%, orange 35%, gold 45%, green 85%);
        }

        .bar-segment {
            height: 100%;
            float: left;
        }

        .segment1 { width: 25%; background-color: red; }
        .segment2 { width: 25%; background-color: orange; }
        .segment3 { width: 25%; background-color: gold; }
        .segment4 { width: 25%; background-color: green; }

        .percentage-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            padding-left: 5px;
        }
    </style>
    <script>
        window.onload = function() {
            const table = document.getElementById('dataTable');
            let totalPercentage = 0;
            let rowCount = 0;

            // Function to load CSV data
            function loadCSV() {
                const xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            parseCSV(xhr.responseText);
                        } else {
                            console.error('Failed to load CSV file');
                        }
                    }
                };
                xhr.open('GET', 'hours.csv');
                xhr.send();
            }
            
            // Function to parse CSV data
            function parseCSV(csvData) {
                const lines = csvData.split('\n');
                table.innerHTML = ''; // Clear existing table content
                
                // Add column headers
                const headerRow = document.createElement('tr');
                ['Name', 'Weekly Hours', 'YTD Performance'].forEach(function(columnHeader) {
                    const th = document.createElement('th');
                    th.textContent = columnHeader;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                // Parse data rows
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    const rowData = line.split(',');
                    if (rowData[0]) { // Check if data exists
                        const row = document.createElement('tr');
                        rowCount++;

                        // Create and style cells
                        rowData.forEach(function(cellData, index) {
                            const cell = document.createElement('td');
                            if (index === 1) { // Weekly Hours column
                                const percentageBar = document.createElement('div');
                                percentageBar.className = 'percentage-bar';
                                setColorSegments(percentageBar, parseInt(cellData));
                                cell.appendChild(percentageBar);
                            } else if (index === 2) { // YTD Performance column
                                const percentageIndicator = document.createElement('div');
                                percentageIndicator.className = 'percentage-indicator';
                                const percentageValue = parseFloat(cellData) * 100;
                                totalPercentage += percentageValue;
                                percentageIndicator.textContent = percentageValue.toFixed(2) + '%';
                                cell.appendChild(percentageIndicator);
                            } else {
                                cell.textContent = cellData;
                            }
                            row.appendChild(cell);
                        });

                        table.appendChild(row);
                    }
                }

                // Calculate the average of YTD Performance
                const averagePercentage = totalPercentage / rowCount;
                
                // Display the average percentage value
                const averagePercentageDisplay = document.getElementById('averagePercentageDisplay');
                averagePercentageDisplay.textContent = averagePercentage.toFixed(2) + '%';
            }
            
            // Function to set color segments based on value
            function setColorSegments(bar, value) {
                if (value >= 0 && value < 19) {
                    bar.innerHTML = '<div class="bar-segment segment1"></div>';
                } else if (value >= 20 && value < 27) {
                    bar.innerHTML = '<div class="bar-segment segment1"></div><div class="bar-segment segment2"></div>';
                } else if (value >= 27 && value < 32) {
                    bar.innerHTML = '<div class="bar-segment segment1"></div><div class="bar-segment segment2"></div><div class="bar-segment segment3"></div>';
                } else if (value >= 33 && value <= 150) {
                    bar.innerHTML = '<div class="bar-segment segment1"></div><div class="bar-segment segment2"></div><div class="bar-segment segment3"></div><div class="bar-segment segment4"></div>';
                }
            }
            
            // Load CSV data on page load
            loadCSV();
        };
    </script>
</head>
<body>
    <div class="content-container">
        <p>Technician Time Gauge<br>Previous Week - This is still a work in progress</p>
        <table id="dataTable"></table>
        <p>Red = 19 hours or less - Orange = 27 hours or less<br>Gold = 32 hours or less - Green = more than 33 hours</p>
        <p>YTD Performance is the percentage of Billed Time to On-Premise time</p>
        <p>Average Shop Performance:</p>
        <div id="averagePercentageDisplay" class="percentage-indicator"></div>
    </div>
</body>
</html>
